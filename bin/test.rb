# frozen_string_literal: true

require "bundler/setup"
require "svggraph" # https://github.com/lumean/svg-graph2
require "SVG/Graph/Plot"
require "ml/forest"
require "ml/service/isolation/novelty"

require "ml/experiment/preprocessor"

input = [[0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50],
         [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47], [0.51], [0.50], [0.45], [0.47]]
service = Ml::Service::Isolation::Novelty.new(batch_size: input.size, max_depth: 10)
forest = Ml::Forest::Tree.new(input, trees_count: 100, forest_helper: service)

outliers = [[0.46], [0.89], [0.99], [1], [0.53]]

# (0-1)
# 0.4-0.6

evaluated_data = outliers.map { |x| forest.fit_predict(x, forest_helper: service) }
pp(evaluated_data.map { |x| x.to_h })
